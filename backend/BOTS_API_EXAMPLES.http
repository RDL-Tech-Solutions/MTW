# ========================================
# API de Bots - Exemplos de Requisi√ß√µes
# ========================================
# Use com extens√µes como REST Client (VS Code) ou Postman
# Substitua {TOKEN_ADMIN} pelo token JWT do admin

### Vari√°veis
@baseUrl = http://localhost:3000/api
@token = SEU_TOKEN_ADMIN_AQUI

# ========================================
# AUTENTICA√á√ÉO
# ========================================

### Login como Admin
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "admin@mtwpromo.com",
  "password": "sua_senha"
}

# ========================================
# GERENCIAMENTO DE CANAIS
# ========================================

### Listar todos os canais
GET {{baseUrl}}/bots/channels
Authorization: Bearer {{token}}

### Listar apenas canais do Telegram
GET {{baseUrl}}/bots/channels?platform=telegram
Authorization: Bearer {{token}}

### Listar apenas canais ativos
GET {{baseUrl}}/bots/channels?is_active=true
Authorization: Bearer {{token}}

### Criar canal do Telegram
POST {{baseUrl}}/bots/channels
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "platform": "telegram",
  "identifier": "-1001234567890",
  "name": "Grupo Principal MTW",
  "is_active": true
}

### Criar canal do WhatsApp
POST {{baseUrl}}/bots/channels
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "platform": "whatsapp",
  "identifier": "120363123456789012@g.us",
  "name": "Grupo WhatsApp Promo√ß√µes",
  "is_active": true
}

### Atualizar canal
PUT {{baseUrl}}/bots/channels/UUID_DO_CANAL
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Novo Nome do Canal",
  "is_active": true
}

### Ativar canal
PATCH {{baseUrl}}/bots/channels/UUID_DO_CANAL/toggle
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "is_active": true
}

### Desativar canal
PATCH {{baseUrl}}/bots/channels/UUID_DO_CANAL/toggle
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "is_active": false
}

### Deletar canal
DELETE {{baseUrl}}/bots/channels/UUID_DO_CANAL
Authorization: Bearer {{token}}

# ========================================
# TESTES
# ========================================

### Enviar teste para todos os canais ativos
POST {{baseUrl}}/bots/test
Authorization: Bearer {{token}}

### Enviar teste para canal espec√≠fico
POST {{baseUrl}}/bots/test
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "channelId": "UUID_DO_CANAL"
}

# ========================================
# LOGS E ESTAT√çSTICAS
# ========================================

### Listar logs (√∫ltimos 50)
GET {{baseUrl}}/bots/logs
Authorization: Bearer {{token}}

### Listar logs com filtros
GET {{baseUrl}}/bots/logs?page=1&limit=20&platform=telegram&status=sent
Authorization: Bearer {{token}}

### Listar logs por tipo de evento
GET {{baseUrl}}/bots/logs?event_type=coupon_new
Authorization: Bearer {{token}}

### Listar logs por per√≠odo
GET {{baseUrl}}/bots/logs?start_date=2024-01-01&end_date=2024-12-31
Authorization: Bearer {{token}}

### Obter estat√≠sticas gerais
GET {{baseUrl}}/bots/stats
Authorization: Bearer {{token}}

### Obter estat√≠sticas por plataforma
GET {{baseUrl}}/bots/stats?platform=telegram
Authorization: Bearer {{token}}

### Obter estat√≠sticas por per√≠odo
GET {{baseUrl}}/bots/stats?start_date=2024-01-01&end_date=2024-12-31
Authorization: Bearer {{token}}

### Verificar status dos bots
GET {{baseUrl}}/bots/status
Authorization: Bearer {{token}}

# ========================================
# CRIAR CUPOM (TESTA NOTIFICA√á√ÉO AUTOM√ÅTICA)
# ========================================

### Criar cupom de teste
POST {{baseUrl}}/coupons
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "code": "TESTE10",
  "platform": "shopee",
  "discount_type": "percentage",
  "discount_value": 10,
  "min_purchase": 50,
  "valid_from": "2024-01-01T00:00:00Z",
  "valid_until": "2024-12-31T23:59:59Z",
  "is_general": true,
  "restrictions": "V√°lido apenas para primeira compra"
}

### Criar cupom que expira em breve (para testar notifica√ß√£o de expira√ß√£o)
POST {{baseUrl}}/coupons
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "code": "EXPIRA_RAPIDO",
  "platform": "mercadolivre",
  "discount_type": "fixed",
  "discount_value": 20,
  "valid_from": "2024-01-01T00:00:00Z",
  "valid_until": "2024-01-01T00:05:00Z",
  "is_general": true
}

# ========================================
# CRIAR PRODUTO (TESTA NOTIFICA√á√ÉO AUTOM√ÅTICA)
# ========================================

### Criar produto com desconto (dispara notifica√ß√£o)
POST {{baseUrl}}/products
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Smartphone XYZ Pro Max 256GB",
  "image_url": "https://exemplo.com/smartphone.jpg",
  "platform": "shopee",
  "current_price": 1299.90,
  "old_price": 2499.90,
  "category_id": "UUID_DA_CATEGORIA",
  "affiliate_link": "https://shope.ee/exemplo",
  "external_id": "PROD123456"
}

### Criar produto sem desconto (N√ÉO dispara notifica√ß√£o)
POST {{baseUrl}}/products
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Fone de Ouvido Bluetooth",
  "image_url": "https://exemplo.com/fone.jpg",
  "platform": "mercadolivre",
  "current_price": 89.90,
  "category_id": "UUID_DA_CATEGORIA",
  "affiliate_link": "https://mercadolivre.com/exemplo",
  "external_id": "PROD789012"
}

# ========================================
# VERIFICA√á√ïES DE SA√öDE
# ========================================

### Health check da API
GET {{baseUrl}}/health

### Verificar se servidor est√° rodando
GET http://localhost:3000/

# ========================================
# TELEGRAM - TESTES DIRETOS
# ========================================

### Verificar bot do Telegram (substitua {TOKEN})
# @name telegramGetMe
GET https://api.telegram.org/bot{SEU_TOKEN_TELEGRAM}/getMe

### Obter atualiza√ß√µes do Telegram (para pegar Chat ID)
# @name telegramGetUpdates
GET https://api.telegram.org/bot{SEU_TOKEN_TELEGRAM}/getUpdates

### Enviar mensagem de teste diretamente pelo Telegram
POST https://api.telegram.org/bot{SEU_TOKEN_TELEGRAM}/sendMessage
Content-Type: application/json

{
  "chat_id": "-1001234567890",
  "text": "ü§ñ Teste direto da API do Telegram",
  "parse_mode": "Markdown"
}

# ========================================
# NOTAS
# ========================================

# 1. Substitua {{token}} pelo token JWT obtido no login
# 2. Substitua UUID_DO_CANAL pelos IDs reais dos canais
# 3. Substitua UUID_DA_CATEGORIA por uma categoria v√°lida
# 4. Para Telegram, o Chat ID de grupos come√ßa com "-"
# 5. Para WhatsApp, use o formato: 120363XXXXXXXXXX@g.us

# ========================================
# FLUXO COMPLETO DE TESTE
# ========================================

# 1. Fazer login e obter token
# 2. Criar canal do Telegram/WhatsApp
# 3. Enviar teste para verificar se est√° funcionando
# 4. Criar um cupom e verificar se notifica√ß√£o foi enviada
# 5. Verificar logs para confirmar envio
# 6. Verificar estat√≠sticas

# ========================================
# TROUBLESHOOTING
# ========================================

# Se notifica√ß√µes n√£o est√£o sendo enviadas:
# - Verifique se ENABLE_CRON_JOBS=true no .env
# - Confirme que h√° canais ativos
# - Verifique os logs: GET /api/bots/logs
# - Teste manualmente: POST /api/bots/test
# - Verifique logs do servidor: tail -f logs/app.log
